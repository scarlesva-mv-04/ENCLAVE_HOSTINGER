<?php

if (!isset($_SESSION["token"])) {
    header("Location:/");
}


$headers[] = "Authorization: Bearer " . $_SESSION["token"];
$url = DIR_SERV . "/cliente/" . $_SESSION["user_id"];

$respuesta = consumir_servicios_JWT_REST($url, "GET", $headers);
$json_respuesta = json_decode($respuesta, true);

if (!$json_respuesta) {
    session_destroy();
    die(error_page("Gestión Libros", "<h1>ENCLAVE</h1><p>Error consumiendo el servicio REST: <strong>$url</strong></p>"));
}

if (isset($json_respuesta["error"])) {
    session_destroy();
    die(error_page("Gestión Libros", "<h1>ENCLAVE</h1><p>" . $json_respuesta["error"] . "</p>"));
}

if (isset($json_respuesta["no_auth"])) {
    session_unset();
    $_SESSION["mensaje_seguridad"] = "El tiempo de sesión de la API ha expirado o no tiene permisos";
    header("Location:index.php");
    exit;
}

if (isset($json_respuesta["mensaje_baneo"])) {
    session_unset();
    $_SESSION["mensaje_seguridad"] = "Usted ya no se encuentra registrado en la BD";
    header("Location:index.php");
    exit;
}

$cliente = $json_respuesta["cliente"];
var_dump($cliente);
?>

<!DOCTYPE html>

<body>
    <main class="user_options">
        <div class="info">
            <span>
                <svg width="268" height="47" viewBox="0 0 268 67" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M186.831 66.2389C186.821 66.2389 186.807 66.2389 186.797 66.2389H156.492C155.977 66.2389 155.491 65.9947 155.172 65.5765C154.852 65.158 154.735 64.6126 154.856 64.093L162.998 28.5715C158.955 25.6553 156.492 20.8322 156.492 15.6883C156.492 7.03865 163.289 0 171.645 0C180 0 186.797 7.03865 186.797 15.6883C186.797 20.8322 184.334 25.6553 180.293 28.5715L188.361 63.767C188.46 63.9884 188.514 64.2361 188.514 64.4956C188.514 65.458 187.76 66.2389 186.831 66.2389ZM158.622 62.7525H184.669L176.743 28.1706C176.569 27.4212 176.894 26.6455 177.537 26.2585C181.17 24.0813 183.43 20.0319 183.43 15.6883C183.43 8.95972 178.142 3.48633 171.645 3.48633C165.148 3.48633 159.859 8.95972 159.859 15.6883C159.859 20.0319 162.119 24.0813 165.754 26.2585C166.397 26.6437 166.72 27.4212 166.548 28.1706L158.622 62.7525Z"
                        fill="#C8BA9B" />
                    <path
                        d="M0 14.0178C2.53317 14.0178 5.04609 14.0074 7.53875 13.9864C10.0517 13.9655 12.3518 13.9445 14.4391 13.9234C16.5265 13.8815 18.3098 13.8292 19.7893 13.7662C21.2685 13.7032 22.2718 13.6192 22.7986 13.5143L21.309 17.7003C20.6402 17.5114 19.8601 17.3436 18.9684 17.1966C18.1984 17.0709 17.256 16.9553 16.1414 16.8505C15.0471 16.7245 13.7805 16.6616 12.3417 16.6616C11.8553 16.6616 11.2676 16.6826 10.5786 16.7245C9.90979 16.7456 9.26131 16.7771 8.63308 16.819C7.90352 16.8609 7.16383 16.903 6.41401 16.9449V34.1292C8.50136 34.1083 10.386 34.0454 12.0681 33.9405C13.7501 33.8354 15.1788 33.7305 16.3542 33.6257C17.7323 33.4997 18.9482 33.353 20.0019 33.1851L19.0596 37.7487C17.6613 37.5598 16.2326 37.3815 14.7735 37.2137C13.517 37.0667 12.1491 36.9407 10.6697 36.8359C9.19039 36.7099 7.7718 36.6472 6.41401 36.6472V56.3807C8.80534 56.3807 11.0041 56.2758 13.0104 56.0661C15.0167 55.8561 16.7696 55.6149 18.2693 55.3422C20.0122 55.0484 21.603 54.7021 23.0419 54.3035L22.1602 59.4023C21.9172 59.3812 21.5523 59.3601 21.066 59.3393C20.5797 59.3182 20.0323 59.2971 19.4244 59.2763C18.8367 59.2552 18.2085 59.2344 17.5397 59.2133C16.8912 59.2133 16.2731 59.2029 15.6854 59.1819C15.0978 59.1819 14.5709 59.1715 14.1047 59.1504C13.6589 59.1504 13.3347 59.1504 13.132 59.1504H0V59.0244C0.12159 58.5839 0.233051 58.0382 0.334383 57.388C0.455973 56.7375 0.557306 55.9295 0.638358 54.9644C0.719433 53.9993 0.780228 52.8557 0.820742 51.5338C0.86128 50.1911 0.881537 48.6278 0.881537 46.8443V26.3554C0.881537 24.5719 0.86128 23.0193 0.820742 21.6974C0.780228 20.3545 0.719433 19.2004 0.638358 18.2353C0.557306 17.2491 0.455973 16.4308 0.334383 15.7805C0.233051 15.13 0.12159 14.5843 0 14.1438V14.0178ZM32.2221 14.0178L63.5321 48.5125V26.3554C63.5321 24.5719 63.512 23.0193 63.4713 21.6974C63.4308 20.3545 63.37 19.2004 63.289 18.2353C63.2079 17.2491 63.1066 16.4308 62.9849 15.7805C62.8837 15.13 62.7721 14.5843 62.6507 14.1438V14.0178H68.0614V14.1438C67.94 14.5843 67.8284 15.13 67.7271 15.7805C67.6258 16.4308 67.5346 17.2491 67.4534 18.2353C67.3725 19.2004 67.3117 20.3545 67.2712 21.6974C67.2305 23.0193 67.2104 24.5719 67.2104 26.3554V59.7798H66.1463L34.8364 25.3167V46.8443C34.8364 48.6278 34.8565 50.1911 34.897 51.5338C34.9377 52.8557 34.9985 53.9993 35.0794 54.9644C35.1606 55.9295 35.2518 56.7375 35.3531 57.388C35.4544 58.0382 35.5657 58.5839 35.6874 59.0244V59.1504H30.2767V59.0244C30.3981 58.5839 30.5096 58.0382 30.6109 57.388C30.7326 56.7375 30.8338 55.9295 30.915 54.9644C30.996 53.9993 31.0568 52.8557 31.0972 51.5338C31.1379 50.1911 31.1581 48.6278 31.1581 46.8443V26.3554C31.1581 24.5719 31.1379 23.0193 31.0972 21.6974C31.0568 20.3545 30.996 19.2004 30.915 18.2353C30.8338 17.2491 30.7326 16.4308 30.6109 15.7805C30.5096 15.13 30.3981 14.5843 30.2767 14.1438V14.0178H32.2221ZM111.804 20.942L111.531 21.0679C109.95 19.5572 108.045 18.3506 105.816 17.4484C103.607 16.5463 101.175 16.0951 98.5203 16.0951C95.9669 16.0951 93.6264 16.5148 91.4984 17.354C89.3705 18.1723 87.5366 19.3683 85.9965 20.942C84.4765 22.5157 83.291 24.446 82.4398 26.733C81.5885 29.0202 81.163 31.6218 81.163 34.5385C81.163 37.7487 81.5684 40.7491 82.379 43.5396C83.1897 46.3093 84.3953 48.7118 85.9965 50.7472C87.5974 52.7823 89.5934 54.3875 91.9847 55.5624C94.3964 56.7164 97.2032 57.2935 100.405 57.2935C101.56 57.2935 102.715 57.1676 103.87 56.9157C105.026 56.6641 106.13 56.2969 107.184 55.8142C108.258 55.3107 109.261 54.7128 110.193 54.0203C111.146 53.3069 112.007 52.4992 112.777 51.5968L113.112 51.8172L110.68 58.2376C109.16 58.8462 107.478 59.3078 105.634 59.6224C103.81 59.9581 101.965 60.1262 100.101 60.1262C96.3519 60.1262 92.9171 59.5701 89.7962 58.458C86.6956 57.325 84.0206 55.7302 81.771 53.674C79.5418 51.6178 77.7991 49.1524 76.5425 46.2778C75.3065 43.3822 74.6883 40.172 74.6883 36.6472C74.6883 34.6537 74.9315 32.692 75.4178 30.7615C75.9245 28.8313 76.6541 26.9953 77.6066 25.2537C78.5589 23.5124 79.7343 21.9175 81.1326 20.47C82.531 19.0011 84.1219 17.7318 85.9052 16.6616C87.7087 15.5916 89.6846 14.7628 91.8329 14.1753C94.0013 13.5669 96.3419 13.2625 98.8549 13.2625C102.766 13.2625 106.394 13.8815 109.737 15.1196L111.804 20.942ZM125.088 56.3807C127.48 56.3807 129.678 56.2758 131.685 56.0661C133.691 55.8561 135.444 55.6149 136.944 55.3422C138.687 55.0484 140.277 54.7021 141.716 54.3035L140.835 59.4023C140.591 59.3812 140.227 59.3601 139.74 59.3393C139.254 59.3182 138.707 59.2971 138.099 59.2763C137.511 59.2552 136.883 59.2344 136.214 59.2133C135.566 59.2133 134.948 59.2029 134.36 59.1819C133.772 59.1819 133.245 59.1715 132.779 59.1504C132.333 59.1504 132.009 59.1504 131.806 59.1504H118.674V59.0244C118.796 58.5839 118.908 58.0382 119.009 57.388C119.13 56.7375 119.232 55.9295 119.313 54.9644C119.394 53.9993 119.455 52.8557 119.495 51.5338C119.536 50.1911 119.556 48.6278 119.556 46.8443V26.3554C119.556 24.5719 119.536 23.0193 119.495 21.6974C119.455 20.3545 119.394 19.2004 119.313 18.2353C119.232 17.2491 119.13 16.4308 119.009 15.7805C118.908 15.13 118.796 14.5843 118.674 14.1438V14.0178H125.97V14.1438C125.848 14.5843 125.727 15.13 125.605 15.7805C125.504 16.4308 125.413 17.2491 125.332 18.2353C125.271 19.2004 125.21 20.3545 125.149 21.6974C125.109 23.0193 125.088 24.5719 125.088 26.3554V56.3807ZM206.039 14.0178V14.1438C205.998 14.2486 205.968 14.4061 205.948 14.6158C205.927 14.8258 205.917 15.0144 205.917 15.1823C205.917 15.8328 205.998 16.5567 206.16 17.354C206.343 18.1304 206.677 19.106 207.163 20.2811L220.63 51.7227L233.64 20.533C233.944 19.7565 234.269 18.9067 234.613 17.9834C234.957 17.0602 235.131 16.1266 235.131 15.1823C235.131 14.9306 235.109 14.7209 235.069 14.5528C235.029 14.3642 234.988 14.2278 234.947 14.1438V14.0178H241.179V14.1438C240.793 14.5424 240.329 15.2559 239.781 16.284C239.235 17.3121 238.636 18.5814 237.987 20.0922L220.569 60.1262H218.137L201.631 21.6344C201.246 20.7323 200.841 19.8614 200.415 19.0222C200.01 18.1827 199.625 17.4274 199.26 16.756C198.895 16.0636 198.571 15.4867 198.287 15.0251C198.004 14.5635 197.811 14.2697 197.71 14.1438V14.0178H206.039ZM244.28 14.0178C246.813 14.0178 249.325 14.0074 251.817 13.9864C254.332 13.9655 256.63 13.9445 258.718 13.9234C260.806 13.8815 262.59 13.8292 264.07 13.7662C265.547 13.7032 266.55 13.6192 267.077 13.5143L265.588 17.7003C264.92 17.5114 264.139 17.3436 263.248 17.1966C262.477 17.0709 261.536 16.9553 260.421 16.8505C259.326 16.7245 258.06 16.6616 256.621 16.6616C256.135 16.6616 255.548 16.6826 254.858 16.7245C254.19 16.7456 253.541 16.7771 252.912 16.819C252.184 16.8609 251.444 16.903 250.694 16.9449V34.1292C252.78 34.1083 254.667 34.0454 256.348 33.9405C258.029 33.8354 259.458 33.7305 260.634 33.6257C262.013 33.4997 263.227 33.353 264.28 33.1851L263.339 37.7487C261.941 37.5598 260.512 37.3815 259.053 37.2137C257.796 37.0667 256.429 36.9407 254.949 36.8359C253.47 36.7099 252.052 36.6472 250.694 36.6472V56.3807C253.084 56.3807 255.285 56.2758 257.291 56.0661C259.295 55.8561 261.05 55.6149 262.549 55.3422C264.292 55.0484 265.882 54.7021 267.321 54.3035L266.44 59.4023C266.196 59.3812 265.832 59.3601 265.346 59.3393C264.86 59.3182 264.312 59.2971 263.703 59.2763C263.117 59.2552 262.487 59.2344 261.819 59.2133C261.17 59.2133 260.552 59.2029 259.966 59.1819C259.377 59.1819 258.85 59.1715 258.385 59.1504C257.938 59.1504 257.614 59.1504 257.411 59.1504H244.28V59.0244C244.402 58.5839 244.512 58.0382 244.615 57.388C244.735 56.7375 244.838 55.9295 244.919 54.9644C244.998 53.9993 245.06 52.8557 245.101 51.5338C245.142 50.1911 245.161 48.6278 245.161 46.8443V26.3554C245.161 24.5719 245.142 23.0193 245.101 21.6974C245.06 20.3545 244.998 19.2004 244.919 18.2353C244.838 17.2491 244.735 16.4308 244.615 15.7805C244.512 15.13 244.402 14.5843 244.28 14.1438V14.0178Z"
                        fill="#C8BA9B" />
                </svg>
            </span>
            <span class="subtitles">
                Gestión de usuario
            </span>
        </div>
        <div class="user-info">
            <div class="rounded-img">
                <picture>
                    <img src="images/photos/<?php echo htmlspecialchars($cliente['profile-pic']); ?>" alt="profile-pic">
                </picture>
            </div>
            <p class="subtitles">
                <?php
                echo htmlspecialchars(ucfirst($cliente["nombre"])) . " " . htmlspecialchars(ucfirst($cliente["apellidos"]));
                ?>
            </p>
        </div>
        <div id="opciones">
            <a id="option1" class="input-txt">
                <div>
                    <span class="resaltar txt-input">Cambiar mi contraseña</span>
                </div>
                <div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 8H13M17 8H20M11 16H20M4 16H7" stroke="#01222F" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M9 18C10.1046 18 11 17.1046 11 16C11 14.8954 10.1046 14 9 14C7.89543 14 7 14.8954 7 16C7 17.1046 7.89543 18 9 18Z" stroke="#01222F" />
                        <path d="M15 10C16.1046 10 17 9.10457 17 8C17 6.89543 16.1046 6 15 6C13.8954 6 13 6.89543 13 8C13 9.10457 13.8954 10 15 10Z" stroke="#01222F" />
                    </svg>
                </div>
            </a>
            <a id="option2" class="input-txt">
                <div>
                    <span class="resaltar txt-input">Modificar nombre de usuario</span>
                </div>
                <div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 8H13M17 8H20M11 16H20M4 16H7" stroke="#01222F" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M9 18C10.1046 18 11 17.1046 11 16C11 14.8954 10.1046 14 9 14C7.89543 14 7 14.8954 7 16C7 17.1046 7.89543 18 9 18Z" stroke="#01222F" />
                        <path d="M15 10C16.1046 10 17 9.10457 17 8C17 6.89543 16.1046 6 15 6C13.8954 6 13 6.89543 13 8C13 9.10457 13.8954 10 15 10Z" stroke="#01222F" />
                    </svg>
                </div>
            </a>
            <a id="option3" class="input-txt">
                <div>
                    <span class="resaltar txt-input">Modificar mi foto de perfil</span>
                </div>
                <div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 8H13M17 8H20M11 16H20M4 16H7" stroke="#01222F" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M9 18C10.1046 18 11 17.1046 11 16C11 14.8954 10.1046 14 9 14C7.89543 14 7 14.8954 7 16C7 17.1046 7.89543 18 9 18Z" stroke="#01222F" />
                        <path d="M15 10C16.1046 10 17 9.10457 17 8C17 6.89543 16.1046 6 15 6C13.8954 6 13 6.89543 13 8C13 9.10457 13.8954 10 15 10Z" stroke="#01222F" />
                    </svg>
                </div>
            </a>
            <a id="option4" class="input-txt">
                <div>
                    <span class="resaltar txt-input">Modificar preferencia de género</span>
                </div>
                <div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 8H13M17 8H20M11 16H20M4 16H7" stroke="#01222F" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M9 18C10.1046 18 11 17.1046 11 16C11 14.8954 10.1046 14 9 14C7.89543 14 7 14.8954 7 16C7 17.1046 7.89543 18 9 18Z" stroke="#01222F" />
                        <path d="M15 10C16.1046 10 17 9.10457 17 8C17 6.89543 16.1046 6 15 6C13.8954 6 13 6.89543 13 8C13 9.10457 13.8954 10 15 10Z" stroke="#01222F" />
                    </svg>
                </div>
            </a>
            <a id="option5" class="input-txt">
                <div>
                    <span class="resaltar txt-input">Modificar mi nombre</span>
                </div>
                <div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 8H13M17 8H20M11 16H20M4 16H7" stroke="#01222F" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M9 18C10.1046 18 11 17.1046 11 16C11 14.8954 10.1046 14 9 14C7.89543 14 7 14.8954 7 16C7 17.1046 7.89543 18 9 18Z" stroke="#01222F" />
                        <path d="M15 10C16.1046 10 17 9.10457 17 8C17 6.89543 16.1046 6 15 6C13.8954 6 13 6.89543 13 8C13 9.10457 13.8954 10 15 10Z" stroke="#01222F" />
                    </svg>
                </div>
            </a>
            <a id="option6" class="input-txt">
                <div>
                    <span class="resaltar txt-input">Modificar mis apellidos</span>
                </div>
                <div>
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M4 8H13M17 8H20M11 16H20M4 16H7" stroke="#01222F" stroke-linecap="round" stroke-linejoin="round" />
                        <path d="M9 18C10.1046 18 11 17.1046 11 16C11 14.8954 10.1046 14 9 14C7.89543 14 7 14.8954 7 16C7 17.1046 7.89543 18 9 18Z" stroke="#01222F" />
                        <path d="M15 10C16.1046 10 17 9.10457 17 8C17 6.89543 16.1046 6 15 6C13.8954 6 13 6.89543 13 8C13 9.10457 13.8954 10 15 10Z" stroke="#01222F" />
                    </svg>
                </div>
            </a>
        </div>
        <button class="txt-botones" onclick="window.location.href='/log_out_successful';">Cerrar sesión</button>
    </main>
</body>